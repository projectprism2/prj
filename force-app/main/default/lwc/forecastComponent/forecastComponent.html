<template>
    <!-- <div class="slds-clearfix slds-var-m-bottom_x-small">
        <lightning-button id="refreshData" variant="brand" label="Refresh" onclick={handleRefreshData} icon-name="utility:refresh" icon-position="right"></lightning-button>
    </div> -->
    <template if:true={forecastList}>
        <lightning-accordion allow-multiple-sections-open active-section-name={activeSections}>
            <lightning-accordion-section name="BudgetSummary" label="Budget Summary">
                <div class="slds-scrollable slds-var-m-bottom_large" style="background-color: white;">
                    <table class="slds-table slds-table_bordered slds-table_col-bordered">
                        <thead>
                            <th></th>
                            <th><span class="slds-align_absolute-center">Budget</span></th>
                            <th><span class="slds-align_absolute-center">Forecasts</span></th>
                            <th><span class="slds-align_absolute-center">Actuals</span></th>
                            <th><span class="slds-align_absolute-center">% of Budget Spent</span></th>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <b>Resources</b>
                                </td>
                                <template for:each={totalAmountsList} for:item="b">
                                   <td key={index}>
                                        <lightning-formatted-number  class="slds-float_right" value={b.resourceAmount} format-style="currency"></lightning-formatted-number>
                                    </td>
                                </template>
                                <template if:true={objPercentageSpent}>
                                    <td>
                                        <lightning-formatted-number class="slds-align_absolute-center" value={objPercentageSpent.resourceAmount} format-style="percent"></lightning-formatted-number>
                                    </td>
                                </template>
                            </tr>
                                <td>
                                    <b>Materials</b>
                                </td>
                                <template for:each={totalAmountsList} for:item="b">
                                    <td key={index}>
                                        <lightning-formatted-number  class="slds-float_right" value={b.materialAmount} format-style="currency"></lightning-formatted-number>
                                    </td>
                                </template>
                                <template if:true={objPercentageSpent}>
                                    <td>
                                        <lightning-formatted-number class="slds-align_absolute-center" value={objPercentageSpent.materialAmount} format-style="percent"></lightning-formatted-number>
                                    </td>
                                </template>
                            </tr>
                                <td>
                                    <b>Fixed costs</b>
                                </td>
                                
                                <template for:each={totalAmountsList} for:item="b">
                                    <td key={index}>
                                         <lightning-formatted-number  class="slds-float_right" value={b.fixedAmount} format-style="currency"></lightning-formatted-number>
                                     </td>
                                </template>
                                <template if:true={objPercentageSpent}>
                                    <td>
                                        <lightning-formatted-number class="slds-align_absolute-center" value={objPercentageSpent.fixedAmount} format-style="percent"></lightning-formatted-number>
                                    </td>
                                </template>
                            </tr>
                                <td>
                                    <b>Totals</b>
                                </td>
                                <template for:each={totalAmountsList} for:item="b">
                                    <td key={index}>
                                        <lightning-formatted-number  class="slds-float_right" value={b.total} format-style="currency"></lightning-formatted-number>
                                    </td>
                                </template>
                                <template if:true={objPercentageSpent}>
                                    <td>
                                        <lightning-formatted-number class="slds-align_absolute-center" value={objPercentageSpent.total} format-style="percent"></lightning-formatted-number>
                                    </td>
                                </template>
                                
                            </tr>
                                
                        </tbody>
                    </table>
                </div>
            </lightning-accordion-section>
            <lightning-accordion-section name="ForecastModelling" label="Forecast Modelling">
                <!-- <div class="slds-text-heading_medium">Forecast Modelling</div> -->
                <div class="slds-scrollable" style="background-color: white;">
                    <table class="slds-table slds-table_bordered slds-scrollable">
                        <thead>
                            <th></th>
                            <template for:each={headers} for:item="header">
                                <th key={header.key}><span class="slds-align_absolute-center">{header.value}</span></th>
                            </template>
                            <!-- <th>Totals</th> -->
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <b>Resources</b>
                                </td>
                                <template for:each={forecastList} for:item="forecast">
                                    <td key={forecast.recordId}>
                                        <lightning-input data-id={forecast.recordId} variant="label-hidden" type="number" value={forecast.resourceAmount} step=".01" disabled={forecast.disableEdit} onchange={handleResourceChange}></lightning-input>
                                    </td>
                                </template>
                                <!-- <td>
                                    <b>{projectVersion.Total_Resource_Forecast__c}</b>
                                </td> -->
                            </tr>
                                <td>
                                    <b>Materials</b>
                                </td>
                                <template for:each={forecastList} for:item="forecast">
                                    <td key={forecast.recordId}>
                                        <lightning-input data-id={forecast.recordId} variant="label-hidden" type="number" value={forecast.materialAmount} step=".01" disabled={forecast.disableEdit} onchange={handleMaterialChange}></lightning-input>
                                    </td>
                                </template>
                                <!-- <td>
                                    <b>{projectVersion.Total_Material_Forecast__c}</b>
                                </td> -->
                            </tr>
                                <td>
                                    <b>Fixed costs</b>
                                </td>
                                <template for:each={forecastList} for:item="forecast">
                                    <td key={forecast.recordId}>
                                        <lightning-input data-id={forecast.recordId} variant="label-hidden" type="number" value={forecast.fixedAmount} step=".01" disabled={forecast.disableEdit} onchange={handleFixedCostChange}></lightning-input>
                                    </td>
                                </template>
                            </tr>
                                <td>
                                    <b>Totals</b>
                                </td>
                                <template for:each={forecastList} for:item="forecast">
                                    <td key={forecast.recordId}>
                                        <lightning-formatted-number  class="slds-align_absolute-center" value={forecast.total} format-style="currency"></lightning-formatted-number>
                                    </td>
                                </template>
                                <!-- <td>
                                    <b>{projectVersion.Total_Forecast__c}</b>
                                </td> -->
                            </tr>
                                
                        </tbody>
                    </table>
                    <div class="slds-align_absolute-center slds-var-m-vertical_medium">
                        <lightning-button id="saveForecast" variant="brand" label="Save" onclick={handleSave}></lightning-button>
                    </div>
                </div>
            </lightning-accordion-section>
            <lightning-accordion-section name="ExpenseAggregator" label="Actual Costs">
                <div class="slds-scrollable" style="background-color: white;">
                    <table class="slds-table slds-table_bordered slds-scrollable">
                        <thead>
                            <th></th>
                            <template for:each={aggregatorHeaders} for:item="ah">
                                <th key={ah.key}><span class="slds-align_absolute-center">{ah.value}</span></th>
                            </template>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <b>Resources</b>
                                </td>
                                <template for:each={aggregatorList} for:item="agg">
                                    <td key={agg.recordId}>
                                        <lightning-input data-id={agg.recordId} variant="label-hidden" type="number" value={agg.resourceAmount} step=".01" disabled={agg.disableEdit} onchange={handleAggregatorResourceChange}></lightning-input>
                                    </td>
                                </template>
                            </tr>
                                <td>
                                    <b>Materials</b>
                                </td>
                                <template for:each={aggregatorList} for:item="agg">
                                    <td key={agg.recordId}>
                                        <lightning-input data-id={agg.recordId} variant="label-hidden" type="number" value={agg.materialAmount} step=".01" disabled={agg.disableEdit} onchange={handleAggregatorMaterialChange}></lightning-input>
                                    </td>
                                </template>
                            </tr>
                                <td>
                                    <b>Fixed costs</b>
                                </td>
                                <template for:each={aggregatorList} for:item="agg">
                                    <td key={agg.recordId}>
                                        <lightning-input data-id={agg.recordId} variant="label-hidden" type="number" value={agg.fixedAmount} step=".01" disabled={agg.disableEdit} onchange={handleAggregatorFixedCostChange}></lightning-input>
                                    </td>
                                </template>
                            </tr>
                                <td>
                                    <b>Totals</b>
                                </td>
                                <template for:each={aggregatorList} for:item="agg">
                                    <td key={agg.recordId}>
                                        <lightning-formatted-number  class="slds-align_absolute-center" value={agg.total} format-style="currency"></lightning-formatted-number>
                                    </td>
                                </template>
                            </tr>
                                
                        </tbody>
                    </table>
                    <div class="slds-align_absolute-center slds-var-m-vertical_medium">
                        <lightning-button id="saveAggregator" variant="brand" label="Save" onclick={handleAggregatorSave}></lightning-button>
                    </div>
                </div>
            </lightning-accordion-section>
        </lightning-accordion>
    </template>
</template>